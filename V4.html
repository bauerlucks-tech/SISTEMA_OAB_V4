"""
SISTEMA OAB - GERADOR DE CARTEIRINHAS
Script de instala√ß√£o completa
"""

import os
import sys
import shutil
from pathlib import Path

def criar_projeto_oab():
    """Cria a estrutura completa do projeto Sistema OAB"""
    
    print("üöÄ Iniciando cria√ß√£o do Sistema OAB...")
    
    # Criar estrutura de diret√≥rios
    diretorios = [
        'static/css',
        'static/js',
        'static/psd_base',
        'static/fotos',
        'static/gerados',
        'static/previews',
        'templates'
    ]
    
    for diretorio in diretorios:
        os.makedirs(diretorio, exist_ok=True)
        print(f"üìÅ Criado: {diretorio}")
    
    # ============ 1. requirements.txt ============
    with open('requirements.txt', 'w', encoding='utf-8') as f:
        f.write("""Flask==2.3.3
Pillow==10.2.0
gunicorn==21.2.0
""")
    print("‚úÖ Criado: requirements.txt")
    
    # ============ 2. runtime.txt ============
    with open('runtime.txt', 'w', encoding='utf-8') as f:
        f.write("python-3.9.16\n")
    print("‚úÖ Criado: runtime.txt")
    
    # ============ 3. Procfile ============
    with open('Procfile', 'w', encoding='utf-8') as f:
        f.write("web: gunicorn app:app\n")
    print("‚úÖ Criado: Procfile")
    
    # ============ 4. .gitignore ============
    with open('.gitignore', 'w', encoding='utf-8') as f:
        f.write("""__pycache__/
*.pyc
*.pyo
*.pyd
.Python
env/
venv/
.env
*.db
*.sqlite3
static/psd_base/*
static/fotos/*
static/gerados/*
static/previews/*
.DS_Store
""")
    print("‚úÖ Criado: .gitignore")
    
    # ============ 5. app.py (PRINCIPAL) ============
    with open('app.py', 'w', encoding='utf-8') as f:
        f.write(""""""
"""
SISTEMA OAB - Gerador de Carteirinhas Profissional
‚ú® Vers√£o 4.0 - Completa e Funcional
"""

from flask import Flask, render_template, request, redirect, url_for, jsonify, send_file, flash
import sqlite3
import os
import json
import uuid
from datetime import datetime
from PIL import Image, ImageDraw, ImageFont, ImageOps
import io
import base64
from werkzeug.utils import secure_filename

# ============ CONFIGURA√á√ÉO ============
app = Flask(__name__, static_folder='static', template_folder='templates')
app.config['SECRET_KEY'] = 'sistema-oab-' + str(uuid.uuid4())
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # 16MB

# Configura√ß√µes de pastas
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
DB_PATH = os.path.join(BASE_DIR, 'database.db')

# Criar pastas necess√°rias
def criar_pastas():
    pastas = [
        'static/psd_base',
        'static/fotos', 
        'static/gerados',
        'static/previews',
        'static/css',
        'static/js'
    ]
    for pasta in pastas:
        os.makedirs(pasta, exist_ok=True)

criar_pastas()

# ============ BANCO DE DADOS ============
def init_db():
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    
    # Configura√ß√£o do sistema
    c.execute('''
        CREATE TABLE IF NOT EXISTS sistema_config (
            id INTEGER PRIMARY KEY,
            psd_frente TEXT DEFAULT 'frente_base.psd',
            psd_verso TEXT DEFAULT 'verso_base.psd',
            area_foto TEXT DEFAULT '[150, 100, 350, 300]',
            logo_empresa TEXT,
            cor_primaria TEXT DEFAULT '#003366',
            cor_secundaria TEXT DEFAULT '#D4AF37',
            ultima_atualizacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    
    # Campos personalizados
    c.execute('''
        CREATE TABLE IF NOT EXISTS campos_personalizados (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            nome TEXT,
            tipo TEXT,
            obrigatorio INTEGER DEFAULT 1,
            posicao TEXT,
            tamanho_fonte INTEGER DEFAULT 24,
            cor TEXT DEFAULT '#000000',
            ordem INTEGER DEFAULT 0
        )
    ''')
    
    # Hist√≥rico de gera√ß√µes
    c.execute('''
        CREATE TABLE IF NOT EXISTS historico_geracoes (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            nome_completo TEXT,
            documento TEXT,
            email TEXT,
            telefone TEXT,
            foto TEXT,
            frente_arquivo TEXT,
            verso_arquivo TEXT,
            data_geracao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            status TEXT DEFAULT 'concluido'
        )
    ''')
    
    # Templates de PSD
    c.execute('''
        CREATE TABLE IF NOT EXISTS templates_psd (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            nome TEXT,
            tipo TEXT,
            arquivo TEXT,
            ativo INTEGER DEFAULT 1,
            data_cadastro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    
    # Inserir configura√ß√£o padr√£o
    c.execute("INSERT OR IGNORE INTO sistema_config (id) VALUES (1)")
    
    # Inserir campos padr√£o
    campos_padrao = [
        ('Nome Completo', 'texto', 1, '[100, 150, 500, 200]', 28, '#000000', 1),
        ('Documento (RG)', 'texto', 1, '[100, 220, 500, 270]', 24, '#000000', 2),
        ('Matr√≠cula', 'texto', 0, '[100, 290, 500, 340]', 22, '#666666', 3),
        ('Institui√ß√£o', 'texto', 1, '[100, 360, 500, 410]', 24, '#000000', 4),
        ('Validade', 'data', 1, '[100, 430, 500, 480]', 22, '#0066CC', 5),
        ('Cargo/Fun√ß√£o', 'texto', 0, '[100, 500, 500, 550]', 22, '#666666', 6)
    ]
    
    for campo in campos_padrao:
        c.execute('''
            INSERT OR IGNORE INTO campos_personalizados 
            (nome, tipo, obrigatorio, posicao, tamanho_fonte, cor, ordem)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        ''', campo)
    
    conn.commit()
    conn.close()

init_db()

# ============ FUN√á√ïES AUXILIARES ============
def gerar_id_unico():
    return str(uuid.uuid4())[:8]

def salvar_imagem_base64(imagem_base64, pasta, nome_arquivo=None):
    """Salva uma imagem em base64"""
    try:
        if nome_arquivo is None:
            nome_arquivo = f"{gerar_id_unico()}.png"
        
        caminho = os.path.join('static', pasta, nome_arquivo)
        
        if ',' in imagem_base64:
            imagem_base64 = imagem_base64.split(',')[1]
        
        img_data = base64.b64decode(imagem_base64)
        with open(caminho, 'wb') as f:
            f.write(img_data)
        
        return nome_arquivo
    except Exception as e:
        print(f"Erro ao salvar imagem: {e}")
        return None

def criar_template_bonito(largura=600, altura=400, titulo="Carteirinha OAB", tipo="frente"):
    """Cria um template visualmente atraente"""
    # Cores da OAB
    cor_fundo = (240, 245, 250)  # Azul muito claro
    cor_primaria = (0, 51, 102)   # Azul OAB
    cor_secundaria = (212, 175, 55)  # Dourado OAB
    
    if tipo == "frente":
        img = Image.new('RGB', (largura, altura), color=cor_fundo)
        draw = ImageDraw.Draw(img)
        
        # Cabe√ßalho gradiente (simulado)
        for i in range(100):
            cor = (
                int(cor_primaria[0] * (100-i)/100),
                int(cor_primaria[1] * (100-i)/100),
                int(cor_primaria[2] * (100-i)/100)
            )
            draw.line([(0, i), (largura, i)], fill=cor, width=1)
        
        # Logo OAB (simulado)
        draw.ellipse([(largura-120, 20), (largura-20, 120)], 
                    outline=cor_secundaria, width=3)
        draw.text((largura-100, 60), "OAB", fill=cor_secundaria, 
                 font=ImageFont.truetype("arial.ttf", 32) if hasattr(ImageFont, 'truetype') else ImageFont.load_default())
        
        # T√≠tulo
        draw.text((50, 130), titulo, fill=cor_primaria, 
                 font=ImageFont.truetype("arial.ttf", 28) if hasattr(ImageFont, 'truetype') else ImageFont.load_default())
        
        # Linha decorativa
        draw.line([(50, 170), (largura-50, 170)], fill=cor_secundaria, width=2)
        
        # √Årea para dados
        draw.rectangle([50, 200, largura-50, altura-50], 
                      outline=(200, 200, 200), width=1, fill=(255, 255, 255))
        
    else:  # Verso
        img = Image.new('RGB', (largura, altura), color=(250, 250, 250))
        draw = ImageDraw.Draw(img)
        
        # Fundo com padr√£o sutil
        for i in range(0, largura, 30):
            draw.line([(i, 0), (i, altura)], fill=(230, 230, 230), width=1)
        for i in range(0, altura, 30):
            draw.line([(0, i), (largura, i)], fill=(230, 230, 230), width=1)
        
        # Conte√∫do do verso
        draw.rectangle([30, 30, largura-30, altura-30], 
                      outline=cor_primaria, width=2)
        
        draw.text((largura//2, 100), "IDENTIFICA√á√ÉO PROFISSIONAL", 
                 fill=cor_primaria, anchor="mm",
                 font=ImageFont.truetype("arial.ttf", 24) if hasattr(ImageFont, 'truetype') else ImageFont.load_default())
        
        draw.text((largura//2, 150), "Conselho Seccional", 
                 fill=(100, 100, 100), anchor="mm",
                 font=ImageFont.truetype("arial.ttf", 18) if hasattr(ImageFont, 'truetype') else ImageFont.load_default())
        
        # QR Code simulado
        draw.rectangle([largura//2-50, 200, largura//2+50, 300], 
                      outline=cor_secundaria, width=2)
        draw.text((largura//2, 250), "QR CODE", 
                 fill=cor_secundaria, anchor="mm",
                 font=ImageFont.truetype("arial.ttf", 14) if hasattr(ImageFont, 'truetype') else ImageFont.load_default())
    
    return img

def aplicar_dados_imagem(imagem, dados, area_foto=None, foto_path=None):
    """Aplica dados a uma imagem template"""
    draw = ImageDraw.Draw(imagem)
    
    try:
        font_grande = ImageFont.truetype("arial.ttf", 28)
        font_media = ImageFont.truetype("arial.ttf", 24)
        font_pequena = ImageFont.truetype("arial.ttf", 20)
    except:
        font_grande = font_media = font_pequena = ImageFont.load_default()
    
    # Aplicar dados nos campos
    y_pos = 210
    for campo, valor in dados.items():
        if valor and campo not in ['foto', 'area_foto']:
            draw.text((70, y_pos), f"{campo}: {valor}", 
                     fill=(0, 0, 0), font=font_media)
            y_pos += 40
    
    # Aplicar foto se existir
    if foto_path and os.path.exists(foto_path) and area_foto:
        try:
            foto = Image.open(foto_path)
            foto = ImageOps.fit(foto, (area_foto[2]-area_foto[0], area_foto[3]-area_foto[1]))
            
            # Adicionar borda √† foto
            foto_com_borda = ImageOps.expand(foto, border=3, fill=(212, 175, 55))
            
            imagem.paste(foto_com_borda, (area_foto[0], area_foto[1]))
        except Exception as e:
            print(f"Erro ao aplicar foto: {e}")
    
    return imagem

# ============ ROTAS PRINCIPAIS ============
@app.route('/')
def index():
    """Dashboard principal"""
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    
    # Estat√≠sticas
    c.execute("SELECT COUNT(*) FROM historico_geracoes")
    total_geracoes = c.fetchone()[0]
    
    c.execute("SELECT COUNT(*) FROM historico_geracoes WHERE date(data_geracao) = date('now')")
    hoje_geracoes = c.fetchone()[0]
    
    c.execute("SELECT * FROM historico_geracoes ORDER BY id DESC LIMIT 5")
    recentes = c.fetchall()
    
    # Configura√ß√£o
    c.execute("SELECT * FROM sistema_config WHERE id = 1")
    config = c.fetchone()
    
    # Campos
    c.execute("SELECT * FROM campos_personalizados ORDER BY ordem")
    campos = c.fetchall()
    
    conn.close()
    
    return render_template('admin.html',
                         total_geracoes=total_geracoes,
                         hoje_geracoes=hoje_geracoes,
                         recentes=recentes,
                         config=config,
                         campos=campos)

@app.route('/upload', methods=['POST'])
def upload():
    """Upload de arquivos"""
    tipo = request.form.get('tipo')
    arquivo = request.files.get('arquivo')
    
    if arquivo:
        filename = secure_filename(arquivo.filename)
        
        if tipo == 'psd_frente':
            caminho = os.path.join('static', 'psd_base', 'frente.psd')
            arquivo.save(caminho)
            
            # Atualizar banco
            conn = sqlite3.connect(DB_PATH)
            c = conn.cursor()
            c.execute("UPDATE sistema_config SET psd_frente = ? WHERE id = 1", (filename,))
            conn.commit()
            conn.close()
            
            flash('PSD frente enviado com sucesso!', 'success')
            
        elif tipo == 'psd_verso':
            caminho = os.path.join('static', 'psd_base', 'verso.psd')
            arquivo.save(caminho)
            
            conn = sqlite3.connect(DB_PATH)
            c = conn.cursor()
            c.execute("UPDATE sistema_config SET psd_verso = ? WHERE id = 1", (filename,))
            conn.commit()
            conn.close()
            
            flash('PSD verso enviado com sucesso!', 'success')
        
        elif tipo == 'foto':
            id_unico = gerar_id_unico()
            filename = f"foto_{id_unico}.png"
            caminho = os.path.join('static', 'fotos', filename)
            arquivo.save(caminho)
            
            return jsonify({'success': True, 'filename': filename})
    
    return redirect(url_for('index'))

@app.route('/configuracao')
def configuracao():
    """P√°gina de configura√ß√£o"""
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    
    c.execute("SELECT * FROM sistema_config WHERE id = 1")
    config = c.fetchone()
    
    c.execute("SELECT * FROM campos_personalizados ORDER BY ordem")
    campos = c.fetchall()
    
    conn.close()
    
    return render_template('configurar.html', config=config, campos=campos)

@app.route('/visualizar')
def visualizar():
    """Visualiza√ß√£o e configura√ß√£o da √°rea da foto"""
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    
    c.execute("SELECT area_foto FROM sistema_config WHERE id = 1")
    area_foto = c.fetchone()
    
    # Criar preview se n√£o existir
    preview_path = 'static/previews/preview_frente.png'
    if not os.path.exists(preview_path):
        img = criar_template_bonito(tipo="frente")
        img.save(preview_path)
    
    conn.close()
    
    return render_template('visualizar.html', 
                         preview=preview_path,
                         area_foto=area_foto[0] if area_foto else '[150, 100, 350, 300]')

@app.route('/gerar')
def gerar():
    """P√°gina para gerar nova carteirinha"""
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    
    c.execute("SELECT * FROM campos_personalizados ORDER BY ordem")
    campos = c.fetchall()
    
    c.execute("SELECT area_foto FROM sistema_config WHERE id = 1")
    area_foto = c.fetchone()
    
    conn.close()
    
    return render_template('gerar.html', 
                         campos=campos,
                         area_foto=area_foto[0] if area_foto else '[150, 100, 350, 300]')

@app.route('/processar_geracao', methods=['POST'])
def processar_geracao():
    """Processa a gera√ß√£o da carteirinha"""
    try:
        # Coletar dados do formul√°rio
        dados = {}
        for key in request.form:
            if key not in ['foto_base64', 'area_foto']:
                dados[key] = request.form[key]
        
        # Processar foto
        foto_nome = None
        foto_base64 = request.form.get('foto_base64')
        if foto_base64:
            foto_nome = salvar_imagem_base64(foto_base64, 'fotos')
        
        # Obter √°rea da foto
        area_foto_str = request.form.get('area_foto', '[150, 100, 350, 300]')
        area_foto = json.loads(area_foto_str)
        
        # Gerar IDs √∫nicos
        id_geracao = gerar_id_unico()
        timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
        
        # Criar carteirinha da frente
        frente_img = criar_template_bonito(titulo="IDENTIFICA√á√ÉO PROFISSIONAL", tipo="frente")
        
        if foto_nome:
            frente_img = aplicar_dados_imagem(
                frente_img, 
                dados, 
                area_foto, 
                os.path.join('static', 'fotos', foto_nome)
            )
        else:
            frente_img = aplicar_dados_imagem(frente_img, dados, area_foto)
        
        frente_nome = f"frente_{id_geracao}_{timestamp}.png"
        frente_path = os.path.join('static', 'gerados', frente_nome)
        frente_img.save(frente_path)
        
        # Criar verso
        verso_img = criar_template_bonito(tipo="verso")
        verso_nome = f"verso_{id_geracao}_{timestamp}.png"
        verso_path = os.path.join('static', 'gerados', verso_nome)
        verso_img.save(verso_path)
        
        # Salvar no hist√≥rico
        conn = sqlite3.connect(DB_PATH)
        c = conn.cursor()
        
        c.execute('''
            INSERT INTO historico_geracoes 
            (nome_completo, documento, email, telefone, foto, frente_arquivo, verso_arquivo)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        ''', (
            dados.get('Nome Completo', ''),
            dados.get('Documento (RG)', ''),
            dados.get('email', ''),
            dados.get('telefone', ''),
            foto_nome,
            frente_nome,
            verso_nome
        ))
        
        conn.commit()
        conn.close()
        
        return render_template('resultado.html',
                             frente=frente_nome,
                             verso=verso_nome,
                             dados=dados,
                             id_geracao=id_geracao)
    
    except Exception as e:
        return render_template('erro.html', erro=str(e))

@app.route('/api/salvar_area_foto', methods=['POST'])
def salvar_area_foto():
    """API para salvar √°rea da foto"""
    data = request.json
    area = data.get('area', [150, 100, 350, 300])
    
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute("UPDATE sistema_config SET area_foto = ? WHERE id = 1", (json.dumps(area),))
    conn.commit()
    conn.close()
    
    return jsonify({'success': True, 'area': area})

@app.route('/api/salvar_campo', methods=['POST'])
def salvar_campo():
    """API para salvar configura√ß√£o de campo"""
    data = request.json
    campo_id = data.get('id')
    
    if campo_id == 'novo':
        # Criar novo campo
        conn = sqlite3.connect(DB_PATH)
        c = conn.cursor()
        c.execute('''
            INSERT INTO campos_personalizados (nome, tipo, obrigatorio, ordem)
            VALUES (?, ?, ?, ?)
        ''', (data.get('nome', 'Novo Campo'), 
              data.get('tipo', 'texto'),
              data.get('obrigatorio', 1),
              data.get('ordem', 99)))
        conn.commit()
        conn.close()
    else:
        # Atualizar campo existente
        conn = sqlite3.connect(DB_PATH)
        c = conn.cursor()
        c.execute('''
            UPDATE campos_personalizados 
            SET nome = ?, tipo = ?, obrigatorio = ?, ordem = ?
            WHERE id = ?
        ''', (data.get('nome'), 
              data.get('tipo'),
              data.get('obrigatorio'),
              data.get('ordem'),
              campo_id))
        conn.commit()
        conn.close()
    
    return jsonify({'success': True})

@app.route('/download/<tipo>/<arquivo>')
def download(tipo, arquivo):
    """Download de arquivos gerados"""
    if tipo == 'frente':
        return send_file(os.path.join('static', 'gerados', arquivo), 
                        as_attachment=True,
                        download_name=f"carteirinha_frente_{arquivo}")
    elif tipo == 'verso':
        return send_file(os.path.join('static', 'gerados', arquivo),
                        as_attachment=True,
                        download_name=f"carteirinha_verso_{arquivo}")
    else:
        return "Tipo inv√°lido", 404

@app.route('/historico')
def historico():
    """P√°gina de hist√≥rico"""
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    
    c.execute("SELECT * FROM historico_geracoes ORDER BY id DESC")
    historico = c.fetchall()
    
    conn.close()
    
    return render_template('historico.html', historico=historico)

@app.route('/api/estatisticas')
def estatisticas():
    """API para estat√≠sticas"""
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    
    # Total por dia (√∫ltimos 7 dias)
    c.execute('''
        SELECT date(data_geracao) as dia, COUNT(*) as total
        FROM historico_geracoes
        WHERE data_geracao >= date('now', '-7 days')
        GROUP BY date(data_geracao)
        ORDER BY dia
    ''')
    dados_7_dias = c.fetchall()
    
    conn.close()
    
    return jsonify({
        'ultimos_7_dias': [
            {'dia': str(dia), 'total': total} 
            for dia, total in dados_7_dias
        ]
    })

# ============ INICIALIZA√á√ÉO ============
if __name__ == '__main__':
    print("""
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë    SISTEMA OAB - GERADOR DE CARTEIRINHAS ‚ïë
    ‚ïë            Vers√£o 4.0 ‚ú®                ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
    """)
    
    port = int(os.environ.get('PORT', 5000))
    print(f"üåê Servidor iniciando em: http://localhost:{port}")
    print("üìÅ Banco de dados: database.db")
    print("‚ú® Sistema pronto para uso!")
    
    app.run(host='0.0.0.0', port=port, debug=True)
""")
    print("‚úÖ Criado: app.py (sistema principal)")
    
    # ============ 6. static/css/style.css ============
    with open('static/css/style.css', 'w', encoding='utf-8') as f:
        f.write(""""""
/* 
SISTEMA OAB - Estilos Profissionais
Desenvolvido com ‚ù§Ô∏è para a Ordem dos Advogados do Brasil
*/

:root {
    /* Cores oficiais OAB */
    --azul-oab: #003366;
    --azul-oab-claro: #1a4d80;
    --dourado-oab: #D4AF37;
    --dourado-oab-claro: #e6c260;
    --cinza-claro: #f8f9fa;
    --cinza-medio: #e9ecef;
    --cinza-escuro: #495057;
    --sucesso: #28a745;
    --alerta: #ffc107;
    --erro: #dc3545;
    --info: #17a2b8;
    
    /* Sombras */
    --sombra-leve: 0 2px 10px rgba(0, 0, 0, 0.08);
    --sombra-media: 0 5px 20px rgba(0, 0, 0, 0.12);
    --sombra-forte: 0 10px 30px rgba(0, 0, 0, 0.15);
    
    /* Bordas */
    --borda-redonda: 12px;
    --borda-suave: 8px;
}

/* Reset e base */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    color: var(--cinza-escuro);
    line-height: 1.6;
    min-height: 100vh;
}

/* Container principal */
.container-oab {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

/* Header/Navbar */
.navbar-oab {
    background: linear-gradient(135deg, var(--azul-oab) 0%, var(--azul-oab-claro) 100%);
    padding: 1.2rem 0;
    box-shadow: var(--sombra-media);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.navbar-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
}

.logo-oab {
    display: flex;
    align-items: center;
    gap: 15px;
    color: white;
    text-decoration: none;
}

.logo-oab i {
    font-size: 2.2rem;
    color: var(--dourado-oab);
}

.logo-text h1 {
    font-size: 1.8rem;
    font-weight: 700;
    margin: 0;
    color: white;
}

.logo-text p {
    font-size: 0.9rem;
    opacity: 0.9;
    margin: 0;
}

.nav-menu {
    display: flex;
    gap: 25px;
    list-style: none;
}

.nav-link {
    color: white;
    text-decoration: none;
    font-weight: 500;
    padding: 8px 16px;
    border-radius: var(--borda-suave);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.nav-link:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

.nav-link.active {
    background: var(--dourado-oab);
    color: var(--azul-oab);
}

/* Cards */
.card-oab {
    background: white;
    border-radius: var(--borda-redonda);
    box-shadow: var(--sombra-leve);
    border: none;
    margin-bottom: 25px;
    transition: all 0.3s ease;
    overflow: hidden;
}

.card-oab:hover {
    transform: translateY(-5px);
    box-shadow: var(--sombra-media);
}

.card-header-oab {
    background: linear-gradient(135deg, var(--azul-oab) 0%, var(--azul-oab-claro) 100%);
    color: white;
    padding: 20px 25px;
    border-bottom: 3px solid var(--dourado-oab);
}

.card-header-oab h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.card-body-oab {
    padding: 25px;
}

/* Bot√µes */
.btn-oab {
    background: linear-gradient(135deg, var(--azul-oab) 0%, var(--azul-oab-claro) 100%);
    color: white;
    border: none;
    padding: 12px 28px;
    border-radius: var(--borda-suave);
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    text-decoration: none;
}

.btn-oab:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 51, 102, 0.3);
    color: white;
}

.btn-oab-secondary {
    background: linear-gradient(135deg, var(--dourado-oab) 0%, var(--dourado-oab-claro) 100%);
    color: var(--azul-oab);
}

.btn-oab-secondary:hover {
    color: var(--azul-oab);
    box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
}

.btn-oab-outline {
    background: transparent;
    border: 2px solid var(--azul-oab);
    color: var(--azul-oab);
}

.btn-oab-outline:hover {
    background: var(--azul-oab);
    color: white;
}

/* Formul√°rios */
.form-group-oab {
    margin-bottom: 20px;
}

.form-label-oab {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--azul-oab);
    font-size: 0.95rem;
}

.form-control-oab {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid var(--cinza-medio);
    border-radius: var(--borda-suave);
    font-size: 1rem;
    transition: all 0.3s ease;
    background: white;
}

.form-control-oab:focus {
    outline: none;
    border-color: var(--azul-oab);
    box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.1);
}

.form-control-oab:hover {
    border-color: var(--azul-oab-claro);
}

/* √Årea de sele√ß√£o da foto */
.selecao-container {
    position: relative;
    display: inline-block;
    border-radius: var(--borda-suave);
    overflow: hidden;
    box-shadow: var(--sombra-media);
    cursor: crosshair;
}

.preview-imagem {
    max-width: 100%;
    display: block;
    transition: transform 0.3s ease;
}

.preview-imagem:hover {
    transform: scale(1.01);
}

.area-selecao {
    position: absolute;
    border: 3px dashed var(--dourado-oab);
    background-color: rgba(212, 175, 55, 0.2);
    pointer-events: none;
}

.coordenadas-display {
    background: white;
    padding: 15px;
    border-radius: var(--borda-suave);
    margin-top: 15px;
    box-shadow: var(--sombra-leve);
    border-left: 4px solid var(--azul-oab);
}

/* Dashboard */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 25px;
    border-radius: var(--borda-redonda);
    box-shadow: var(--sombra-leve);
    text-align: center;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--sombra-media);
}

.stat-card i {
    font-size: 2.5rem;
    margin-bottom: 15px;
}

.stat-card .stat-numero {
    font-size: 2.8rem;
    font-weight: 700;
    color: var(--azul-oab);
    display: block;
    line-height: 1;
    margin: 10px 0;
}

.stat-card .stat-label {
    color: var(--cinza-escuro);
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Tabelas */
.table-oab {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: white;
    border-radius: var(--borda-suave);
    overflow: hidden;
    box-shadow: var(--sombra-leve);
}

.table-oab thead {
    background: linear-gradient(135deg, var(--azul-oab) 0%, var(--azul-oab-claro) 100%);
    color: white;
}

.table-oab th {
    padding: 18px 20px;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
    border: none;
}

.table-oab tbody tr {
    transition: all 0.3s ease;
}

.table-oab tbody tr:hover {
    background-color: rgba(0, 51, 102, 0.05);
}

.table-oab td {
    padding: 16px 20px;
    border-top: 1px solid var(--cinza-medio);
    vertical-align: middle;
}

/* Alertas */
.alert-oab {
    padding: 18px 22px;
    border-radius: var(--borda-suave);
    margin-bottom: 20px;
    border-left: 5px solid;
    background: white;
    box-shadow: var(--sombra-leve);
}

.alert-success-oab {
    border-left-color: var(--sucesso);
    background: linear-gradient(90deg, rgba(40, 167, 69, 0.1) 0%, white 100%);
}

.alert-warning-oab {
    border-left-color: var(--alerta);
    background: linear-gradient(90deg, rgba(255, 193, 7, 0.1) 0%, white 100%);
}

.alert-info-oab {
    border-left-color: var(--info);
    background: linear-gradient(90deg, rgba(23, 162, 184, 0.1) 0%, white 100%);
}

.alert-danger-oab {
    border-left-color: var(--erro);
    background: linear-gradient(90deg, rgba(220, 53, 69, 0.1) 0%, white 100%);
}

/* Preview da carteirinha */
.preview-carteirinha {
    max-width: 100%;
    border-radius: var(--borda-redonda);
    box-shadow: var(--sombra-forte);
    border: 5px solid white;
    transition: all 0.3s ease;
}

.preview-carteirinha:hover {
    transform: scale(1.02);
}

/* Anima√ß√µes */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.fade-in {
    animation: fadeIn 0.5s ease-out;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.pulse {
    animation: pulse 2s infinite;
}

/* Responsividade */
@media (max-width: 768px) {
    .container-oab {
        padding: 15px;
    }
    
    .navbar-content {
        flex-direction: column;
        gap: 15px;
        padding: 0 15px;
    }
    
    .nav-menu {
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
    }
    
    .nav-link {
        padding: 6px 12px;
        font-size: 0.9rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .card-header-oab h2 {
        font-size: 1.3rem;
    }
    
    .btn-oab {
        width: 100%;
        margin-bottom: 10px;
    }
}

/* Dark mode suporte */
@media (prefers-color-scheme: dark) {
    :root {
        --cinza-claro: #1a1a1a;
        --cinza-medio: #2d2d2d;
        --cinza-escuro: #e0e0e0;
    }
    
    body {
        background: linear-gradient(135deg, #121212 0%, #2d2d2d 100%);
        color: var(--cinza-escuro);
    }
    
    .card-oab {
        background: #2d2d2d;
    }
    
    .form-control-oab {
        background: #3d3d3d;
        border-color: #4d4d4d;
        color: white;
    }
    
    .coordenadas-display {
        background: #3d3d3d;
    }
}

/* Custom scrollbar */
::-webkit-scrollbar {
    width: 10px;
}

::-webkit-scrollbar-track {
    background: var(--cinza-claro);
}

::-webkit-scrollbar-thumb {
    background: var(--azul-oab);
    border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--azul-oab-claro);
}
""")
    print("‚úÖ Criado: static/css/style.css")
    
    # ============ 7. static/js/script.js ============
    with open('static/js/script.js', 'w', encoding='utf-8') as f:
        f.write(""""""
/**
 * SISTEMA OAB - JavaScript Principal
 * Funcionalidades completas para o gerador de carteirinhas
 */

// ============ SISTEMA DE SELE√á√ÉO DA FOTO (2 CLICKS) ============
class SistemaSelecaoFoto {
    constructor() {
        this.imagem = document.getElementById('preview-imagem');
        this.area = document.getElementById('area-selecao');
        this.status = document.getElementById('status-selecao');
        this.coordenadasDisplay = document.getElementById('coordenadas-display');
        this.btnSalvar = document.getElementById('btn-salvar-area');
        this.btnLimpar = document.getElementById('btn-limpar-area');
        
        this.cliqueAtual = 0;
        this.coordenadas = {
            x1: 0, y1: 0,
            x2: 0, y2: 0
        };
        
        this.iniciar();
    }
    
    iniciar() {
        if (!this.imagem) return;
        
        // Eventos da imagem
        this.imagem.addEventListener('click', this.clicar.bind(this));
        
        // Eventos dos bot√µes
        if (this.btnSalvar) {
            this.btnSalvar.addEventListener('click', this.salvar.bind(this));
        }
        
        if (this.btnLimpar) {
            this.btnLimpar.addEventListener('click', this.limpar.bind(this));
        }
        
        // Carregar √°rea salva
        this.carregarAreaSalva();
        
        console.log('‚úÖ Sistema de sele√ß√£o iniciado');
    }
    
    clicar(event) {
        const rect = this.imagem.getBoundingClientRect();
        const x = Math.round(event.clientX - rect.left);
        const y = Math.round(event.clientY - rect.top);
        
        if (this.cliqueAtual === 0) {
            // Primeiro clique
            this.coordenadas.x1 = x;
            this.coordenadas.y1 = y;
            this.area.style.left = x + 'px';
            this.area.style.top = y + 'px';
            this.area.style.width = '0px';
            this.area.style.height = '0px';
            this.area.style.display = 'block';
            this.cliqueAtual = 1;
            
            this.atualizarStatus('üü° Primeiro ponto definido. Clique no segundo ponto.', 'warning');
        } else {
            // Segundo clique
            this.coordenadas.x2 = x;
            this.coordenadas.y2 = y;
            
            // Garantir que x2 > x1 e y2 > y1
            if (this.coordenadas.x2 < this.coordenadas.x1) {
                [this.coordenadas.x1, this.coordenadas.x2] = [this.coordenadas.x2, this.coordenadas.x1];
            }
            if (this.coordenadas.y2 < this.coordenadas.y1) {
                [this.coordenadas.y1, this.coordenadas.y2] = [this.coordenadas.y2, this.coordenadas.y1];
            }
            
            const largura = this.coordenadas.x2 - this.coordenadas.x1;
            const altura = this.coordenadas.y2 - this.coordenadas.y1;
            
            this.area.style.left = this.coordenadas.x1 + 'px';
            this.area.style.top = this.coordenadas.y1 + 'px';
            this.area.style.width = largura + 'px';
            this.area.style.height = altura + 'px';
            this.cliqueAtual = 0;
            
            this.atualizarStatus('‚úÖ √Årea selecionada! Verifique as coordenadas abaixo.', 'success');
            this.mostrarCoordenadas();
            
            if (this.btnSalvar) {
                this.btnSalvar.disabled = false;
                this.btnSalvar.classList.remove('btn-secondary');
                this.btnSalvar.classList.add('btn-oab');
            }
        }
    }
    
    carregarAreaSalva() {
        const areaSalva = document.getElementById('area-foto-salva');
        if (areaSalva && areaSalva.value) {
            try {
                const area = JSON.parse(areaSalva.value);
                this.coordenadas = {
                    x1: area[0], y1: area[1],
                    x2: area[2], y2: area[3]
                };
                
                const largura = this.coordenadas.x2 - this.coordenadas.x1;
                const altura = this.coordenadas.y2 - this.coordenadas.y1;
                
                this.area.style.left = this.coordenadas.x1 + 'px';
                this.area.style.top = this.coordenadas.y1 + 'px';
                this.area.style.width = largura + 'px';
                this.area.style.height = altura + 'px';
                this.area.style.display = 'block';
                
                this.mostrarCoordenadas();
                this.atualizarStatus('‚úÖ √Årea carregada do banco de dados.', 'success');
                
                console.log('√Årea carregada:', this.coordenadas);
            } catch (e) {
                console.log('Nenhuma √°rea salva encontrada');
            }
        }
    }
    
    mostrarCoordenadas() {
        if (!this.coordenadasDisplay) return;
        
        const largura = this.coordenadas.x2 - this.coordenadas.x1;
        const altura = this.coordenadas.y2 - this.coordenadas.y1;
        
        this.coordenadasDisplay.innerHTML = `
            <div class="coordenadas-display">
                <h5><i class="fas fa-ruler-combined"></i> Coordenadas da √Årea</h5>
                <div class="row mt-3">
                    <div class="col-md-3">
                        <div class="coord-item">
                            <small>X1 (Esquerda)</small>
                            <div class="coord-value">${this.coordenadas.x1}px</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="coord-item">
                            <small>Y1 (Topo)</small>
                            <div class="coord-value">${this.coordenadas.y1}px</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="coord-item">
                            <small>X2 (Direita)</small>
                            <div class="coord-value">${this.coordenadas.x2}px</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="coord-item">
                            <small>Y2 (Base)</small>
                            <div class="coord-value">${this.coordenadas.y2}px</div>
                        </div>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-6">
                        <div class="coord-item">
                            <small>Largura</small>
                            <div class="coord-value">${largura}px</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="coord-item">
                            <small>Altura</small>
                            <div class="coord-value">${altura}px</div>
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <small><i class="fas fa-info-circle"></i> √Årea para foto 3x4</small>
                </div>
            </div>
        `;
    }
    
    atualizarStatus(mensagem, tipo = 'info') {
        if (!this.status) return;
        
        this.status.textContent = mensagem;
        this.status.className = `alert alert-${tipo} alert-oab fade-in`;
    }
    
    limpar() {
        this.cliqueAtual = 0;
        this.coordenadas = { x1: 0, y1: 0, x2: 0, y2: 0 };
        this.area.style.display = 'none';
        
        if (this.btnSalvar) {
            this.btnSalvar.disabled = true;
            this.btnSalvar.classList.remove('btn-oab');
            this.btnSalvar.classList.add('btn-secondary');
        }
        
        this.atualizarStatus('üñ±Ô∏è Clique na imagem para selecionar o primeiro ponto.', 'info');
        
        if (this.coordenadasDisplay) {
            this.coordenadasDisplay.innerHTML = '';
        }
    }
    
    salvar() {
        // Validar √°rea m√≠nima
        const largura = this.coordenadas.x2 - this.coordenadas.x1;
        const altura = this.coordenadas.y2 - this.coordenadas.y1;
        
        if (largura < 50 || altura < 50) {
            this.atualizarStatus('‚ö†Ô∏è √Årea muito pequena! Selecione uma √°rea maior.', 'warning');
            return;
        }
        
        // Mostrar loading
        const loading = this.mostrarLoading('Salvando √°rea...');
        
        fetch('/api/salvar_area_foto', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(this.coordenadas)
        })
        .then(response => response.json())
        .then(data => {
            loading.remove();
            
            if (data.success) {
                this.atualizarStatus('‚úÖ √Årea salva com sucesso no banco de dados!', 'success');
                
                // Anima√ß√£o de confirma√ß√£o
                this.area.style.border = '3px solid #28a745';
                setTimeout(() => {
                    this.area.style.border = '3px dashed #D4AF37';
                }, 2000);
                
                // Atualizar campo hidden se existir
                const areaSalva = document.getElementById('area-foto-salva');
                if (areaSalva) {
                    areaSalva.value = JSON.stringify([
                        this.coordenadas.x1,
                        this.coordenadas.y1,
                        this.coordenadas.x2,
                        this.coordenadas.y2
                    ]);
                }
            } else {
                this.atualizarStatus('‚ùå Erro ao salvar √°rea: ' + (data.error || 'Erro desconhecido'), 'danger');
            }
        })
        .catch(error => {
            loading.remove();
            console.error('Erro:', error);
            this.atualizarStatus('‚ùå Erro de conex√£o ao salvar √°rea', 'danger');
        });
    }
    
    mostrarLoading(mensagem) {
        const loading = document.createElement('div');
        loading.className = 'loading-overlay';
        loading.innerHTML = `
            <div style="
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 9999;
            ">
                <div class="spinner-border text-light" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">${mensagem}</span>
                </div>
            </div>
        `;
        document.body.appendChild(loading);
        return loading;
    }
}

// ============ GERENCIADOR DE CAMPOS ============
class GerenciadorCampos {
    constructor() {
        this.camposContainer = document.getElementById('campos-container');
        this.btnNovoCampo = document.getElementById('btn-novo-campo');
        this.iniciar();
    }
    
    iniciar() {
        if (!this.camposContainer) return;
        
        // Evento para novo campo
        if (this.btnNovoCampo) {
            this.btnNovoCampo.addEventListener('click', () => this.adicionarCampo());
        }
        
        // Eventos para campos existentes
        this.configurarEventosCampos();
        
        console.log('‚úÖ Gerenciador de campos iniciado');
    }
    
    configurarEventosCampos() {
        // Eventos para checkboxes de obrigat√≥rio
        document.querySelectorAll('.campo-obrigatorio').forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
                const campoId = e.target.dataset.id;
                this.salvarCampo(campoId, 'obrigatorio', e.target.checked ? 1 : 0);
            });
        });
        
        // Eventos para inputs de nome
        document.querySelectorAll('.campo-nome').forEach(input => {
            input.addEventListener('blur', (e) => {
                const campoId = e.target.dataset.id;
                const nome = e.target.value.trim();
                if (nome) {
                    this.salvarCampo(campoId, 'nome', nome);
                }
            });
        });
        
        // Eventos para selects de tipo
        document.querySelectorAll('.campo-tipo').forEach(select => {
            select.addEventListener('change', (e) => {
                const campoId = e.target.dataset.id;
                this.salvarCampo(campoId, 'tipo', e.target.value);
            });
        });
        
        // Eventos para bot√µes de remover
        document.querySelectorAll('.btn-remover-campo').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const campoId = e.target.dataset.id;
                if (confirm('Tem certeza que deseja remover este campo?')) {
                    this.removerCampo(campoId);
                }
            });
        });
    }
    
    adicionarCampo() {
        const novoId = 'novo_' + Date.now();
        
        const campoHTML = `
            <div class="campo-item fade-in" data-id="${novoId}">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <input type="text" 
                               class="form-control form-control-oab campo-nome" 
                               data-id="${novoId}"
                               placeholder="Nome do campo"
                               value="Novo Campo">
                    </div>
                    <div class="col-md-3">
                        <select class="form-control form-control-oab campo-tipo" data-id="${novoId}">
                            <option value="texto">Texto</option>
                            <option value="numero">N√∫mero</option>
                            <option value="data">Data</option>
                            <option value="email">Email</option>
                            <option value="telefone">Telefone</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input campo-obrigatorio" 
                                   type="checkbox" 
                                   data-id="${novoId}"
                                   id="obrigatorio_${novoId}"
                                   checked>
                            <label class="form-check-label" for="obrigatorio_${novoId}">
                                Obrigat√≥rio
                            </label>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-danger btn-sm btn-remover-campo" data-id="${novoId}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        this.camposContainer.insertAdjacentHTML('beforeend', campoHTML);
        
        // Configurar eventos do novo campo
        const novoCampo = this.camposContainer.querySelector(`[data-id="${novoId}"]`);
        novoCampo.querySelector('.campo-obrigatorio').addEventListener('change', (e) => {
            this.salvarCampo(novoId, 'obrigatorio', e.target.checked ? 1 : 0);
        });
        
        novoCampo.querySelector('.campo-nome').addEventListener('blur', (e) => {
            const nome = e.target.value.trim();
            if (nome) {
                this.salvarCampo(novoId, 'nome', nome);
            }
        });
        
        novoCampo.querySelector('.campo-tipo').addEventListener('change', (e) => {
            this.salvarCampo(novoId, 'tipo', e.target.value);
        });
        
        novoCampo.querySelector('.btn-remover-campo').addEventListener('click', (e) => {
            if (confirm('Tem certeza que deseja remover este campo?')) {
                this.removerCampo(novoId);
            }
        });
        
        // Salvar automaticamente
        this.salvarCampo(novoId, 'novo', true);
    }
    
    salvarCampo(campoId, campo, valor) {
        fetch('/api/salvar_campo', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                id: campoId,
                [campo]: valor
            })
        })
        .then(response => response.json())
        .then(data => {
            if (!data.success) {
                console.error('Erro ao salvar campo:', data.error);
            }
        })
        .catch(error => {
            console.error('Erro de conex√£o:', error);
        });
    }
    
    removerCampo(campoId) {
        fetch('/api/salvar_campo', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                id: campoId,
                remover: true
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const campoItem = document.querySelector(`[data-id="${campoId}"]`);
                if (campoItem) {
                    campoItem.style.opacity = '0.5';
                    setTimeout(() => campoItem.remove(), 300);
                }
            }
        });
    }
}

// ============ UPLOAD DE FOTO COM PREVIEW ============
class UploadFotoPreview {
    constructor() {
        this.inputFoto = document.getElementById('foto-input');
        this.previewContainer = document.getElementById('foto-preview-container');
        this.btnRemoverFoto = document.getElementById('btn-remover-foto');
        
        this.iniciar();
    }
    
    iniciar() {
        if (!this.inputFoto) return;
        
        this.inputFoto.addEventListener('change', this.uploadFoto.bind(this));
        
        if (this.btnRemoverFoto) {
            this.btnRemoverFoto.addEventListener('click', this.removerFoto.bind(this));
        }
        
        console.log('‚úÖ Upload de foto iniciado');
    }
    
    uploadFoto(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        // Validar tipo de arquivo
        if (!file.type.match('image.*')) {
            alert('Por favor, selecione uma imagem (JPG, PNG, etc.)');
            return;
        }
        
        // Validar tamanho (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
            alert('A imagem deve ter no m√°ximo 5MB');
            return;
        }
        
        // Mostrar preview
        const reader = new FileReader();
        reader.onload = (e) => {
            this.mostrarPreview(e.target.result);
            
            // Converter para base64 para envio
            const base64Image = e.target.result;
            document.getElementById('foto-base64').value = base64Image;
            
            // Mostrar bot√£o de remover
            if (this.btnRemoverFoto) {
                this.btnRemoverFoto.style.display = 'block';
            }
        };
        
        reader.readAsDataURL(file);
    }
    
    mostrarPreview(dataUrl) {
        if (!this.previewContainer) return;
        
        this.previewContainer.innerHTML = `
            <div class="foto-preview fade-in">
                <img src="${dataUrl}" alt="Preview da foto">
                <div class="foto-overlay">
                    <span class="foto-text">Foto 3x4</span>
                </div>
            </div>
        `;
    }
    
    removerFoto() {
        this.inputFoto.value = '';
        document.getElementById('foto-base64').value = '';
        
        if (this.previewContainer) {
            this.previewContainer.innerHTML = `
                <div class="foto-placeholder">
                    <i class="fas fa-user-circle fa-5x text-muted"></i>
                    <p class="mt-2">Nenhuma foto selecionada</p>
                </div>
            `;
        }
        
        if (this.btnRemoverFoto) {
            this.btnRemoverFoto.style.display = 'none';
        }
    }
}

// ============ VALIDA√á√ÉO DE FORMUL√ÅRIOS ============
class ValidadorFormulario {
    constructor() {
        this.formularios = document.querySelectorAll('form');
        this.iniciar();
    }
    
    iniciar() {
        this.formularios.forEach(form => {
            form.addEventListener('submit', this.validar.bind(this));
            
            // Valida√ß√£o em tempo real
            form.querySelectorAll('[required]').forEach(input => {
                input.addEventListener('blur', () => this.validarCampo(input));
            });
        });
        
        console.log('‚úÖ Validador de formul√°rios iniciado');
    }
    
    validar(event) {
        let valido = true;
        const form = event.target;
        
        form.querySelectorAll('[required]').forEach(input => {
            if (!this.validarCampo(input)) {
                valido = false;
            }
        });
        
        if (!valido) {
            event.preventDefault();
            this.mostrarErroGeral('Por favor, preencha todos os campos obrigat√≥rios corretamente.');
        }
    }
    
    validarCampo(input) {
        const valor = input.value.trim();
        const tipo = input.type;
        const nome = input.name || input.id;
        
        let valido = true;
        let mensagem = '';
        
        if (!valor) {
            valido = false;
            mensagem = 'Este campo √© obrigat√≥rio';
        } else if (tipo === 'email' && !this.validarEmail(valor)) {
            valido = false;
            mensagem = 'Email inv√°lido';
        } else if (nome.includes('telefone') && !this.validarTelefone(valor)) {
            valido = false;
            mensagem = 'Telefone inv√°lido';
        } else if (nome.includes('cpf') && !this.validarCPF(valor)) {
            valido = false;
            mensagem = 'CPF inv√°lido';
        }
        
        if (valido) {
            this.mostrarSucesso(input);
        } else {
            this.mostrarErro(input, mensagem);
        }
        
        return valido;
    }
    
    validarEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
    
    validarTelefone(telefone) {
        const re = /^\(?\d{2}\)?[\s-]?\d{4,5}[\s-]?\d{4}$/;
        return re.test(telefone);
    }
    
    validarCPF(cpf) {
        // Implementa√ß√£o b√°sica de valida√ß√£o de CPF
        cpf = cpf.replace(/[^\d]/g, '');
        return cpf.length === 11;
    }
    
    mostrarErro(input, mensagem) {
        input.classList.add('is-invalid');
        input.classList.remove('is-valid');
        
        let feedback = input.nextElementSibling;
        if (!feedback || !feedback.classList.contains('invalid-feedback')) {
            feedback = document.createElement('div');
            feedback.className = 'invalid-feedback';
            input.parentNode.appendChild(feedback);
        }
        
        feedback.textContent = mensagem;
        feedback.style.display = 'block';
    }
    
    mostrarSucesso(input) {
        input.classList.add('is-valid');
        input.classList.remove('is-invalid');
        
        const feedback = input.nextElementSibling;
        if (feedback && feedback.classList.contains('invalid-feedback')) {
            feedback.style.display = 'none';
        }
    }
    
    mostrarErroGeral(mensagem) {
        // Criar ou atualizar alerta geral
        let alerta = document.getElementById('alerta-geral');
        if (!alerta) {
            alerta = document.createElement('div');
            alerta.id = 'alerta-geral';
            alerta.className = 'alert alert-danger alert-oab fade-in';
            document.querySelector('.container-oab').prepend(alerta);
        }
        
        alerta.innerHTML = `
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Erro:</strong> ${mensagem}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        // Auto-remover ap√≥s 5 segundos
        setTimeout(() => {
            if (alerta) alerta.remove();
        }, 5000);
    }
}

// ============ INICIALIZA√á√ÉO GERAL ============
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Sistema OAB inicializando...');
    
    // Inicializar sistemas
    new SistemaSelecaoFoto();
    new GerenciadorCampos();
    new UploadFotoPreview();
    new ValidadorFormulario();
    
    // Anima√ß√µes de entrada
    document.querySelectorAll('.card-oab').forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.classList.add('fade-in');
    });
    
    // Tooltips do Bootstrap
    if (typeof bootstrap !== 'undefined') {
        const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        tooltips.forEach(tooltip => new bootstrap.Tooltip(tooltip));
    }
    
    // Atualizar data/hora
    function atualizarDataHora() {
        const elemento = document.getElementById('data-hora-atual');
        if (elemento) {
            const agora = new Date();
            elemento.textContent = agora.toLocaleDateString('pt-BR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    }
    
    atualizarDataHora();
    setInterval(atualizarDataHora, 60000); // Atualizar a cada minuto
    
    console.log('‚úÖ Sistema OAB totalmente inicializado!');
});

// ============ FUN√á√ïES GLOBAIS √öTEIS ============
window.SistemaOAB = {
    // Formatar CPF/CNPJ
    formatarDocumento(valor) {
        valor = valor.replace(/\D/g, '');
        
        if (valor.length <= 11) {
            // CPF
            return valor.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        } else {
            // CNPJ
            return valor.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
        }
    },
    
    // Formatar telefone
    formatarTelefone(valor) {
        valor = valor.replace(/\D/g, '');
        
        if (valor.length === 11) {
            return valor.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
        } else if (valor.length === 10) {
            return valor.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
        } else {
            return valor;
        }
    },
    
    // Copiar para √°rea de transfer√™ncia
    copiarTexto(texto, elemento) {
        navigator.clipboard.writeText(texto).then(() => {
            if (elemento) {
                const original = elemento.innerHTML;
                elemento.innerHTML = '<i class="fas fa-check"></i> Copiado!';
                elemento.classList.add('btn-success');
                
                setTimeout(() => {
                    elemento.innerHTML = original;
                    elemento.classList.remove('btn-success');
                }, 2000);
            }
        });
    },
    
    // Gerar PDF (simula√ß√£o)
    gerarPDF(nomeArquivo) {
        alert(`Gerando PDF: ${nomeArquivo}\n\nEm produ√ß√£o, esta fun√ß√£o geraria um PDF da carteirinha.`);
    },
    
    // Compartilhar resultado
    compartilharResultado(titulo, texto, url) {
        if (navigator.share) {
            navigator.share({
                title: titulo,
                text: texto,
                url: url
            });
        } else {
            alert('Compartilhe manualmente:\n\n' + texto + '\n' + url);
        }
    }
};
""")
    print("‚úÖ Criado: static/js/script.js")
    
    # ============ 8. templates/ (p√°ginas HTML) ============
    
    # admin.html
    with open('templates/admin.html', 'w', encoding='utf-8') as f:
        f.write(""""""
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema OAB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öñÔ∏è</text></svg>">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar-oab">
        <div class="navbar-content">
            <a href="/" class="logo-oab">
                <i class="fas fa-balance-scale"></i>
                <div class="logo-text">
                    <h1>Sistema OAB</h1>
                    <p>Gerador de Carteirinhas Profissional</p>
                </div>
            </a>
            
            <ul class="nav-menu">
                <li><a href="/" class="nav-link active"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="/configuracao" class="nav-link"><i class="fas fa-cogs"></i> Configura√ß√£o</a></li>
                <li><a href="/visualizar" class="nav-link"><i class="fas fa-crop-alt"></i> √Årea da Foto</a></li>
                <li><a href="/gerar" class="nav-link"><i class="fas fa-id-card"></i> Gerar Carteirinha</a></li>
                <li><a href="/historico" class="nav-link"><i class="fas fa-history"></i> Hist√≥rico</a></li>
            </ul>
        </div>
    </nav>

    <div class="container-oab">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="mb-1"><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                <p class="text-muted mb-0" id="data-hora-atual">Carregando data...</p>
            </div>
            <div>
                <span class="badge bg-success p-2">
                    <i class="fas fa-circle"></i> Sistema Online
                </span>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-id-card text-primary"></i>
                <span class="stat-numero">{{ total_geracoes }}</span>
                <span class="stat-label">Carteirinhas Geradas</span>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-calendar-day text-success"></i>
                <span class="stat-numero">{{ hoje_geracoes }}</span>
                <span class="stat-label">Geradas Hoje</span>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-cogs text-warning"></i>
                <span class="stat-numero">{{ campos|length }}</span>
                <span class="stat-label">Campos Configurados</span>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-check-circle text-info"></i>
                <span class="stat-numero">100%</span>
                <span class="stat-label">Sistema Operacional</span>
            </div>
        </div>

        <!-- A√ß√µes R√°pidas -->
        <div class="card-oab">
            <div class="card-header-oab">
                <h2><i class="fas fa-bolt"></i> A√ß√µes R√°pidas</h2>
            </div>
            <div class="card-body-oab">
                <div class="row g-3">
                    <div class="col-md-3">
                        <a href="/gerar" class="btn-oab w-100">
                            <i class="fas fa-plus"></i> Nova Carteirinha
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="/configuracao" class="btn-oab btn-oab-secondary w-100">
                            <i class="fas fa-sliders-h"></i> Configurar
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="/visualizar" class="btn-oab btn-oab-outline w-100">
                            <i class="fas fa-crop"></i> √Årea da Foto
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="/historico" class="btn-oab btn-oab-outline w-100">
                            <i class="fas fa-download"></i> Exportar Tudo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload de Templates -->
        <div class="row">
            <div class="col-md-6">
                <div class="card-oab h-100">
                    <div class="card-header-oab">
                        <h2><i class="fas fa-upload"></i> Upload de Templates</h2>
                    </div>
                    <div class="card-body-oab">
                        <form action="/upload" method="post" enctype="multipart/form-data" class="mb-3">
                            <input type="hidden" name="tipo" value="psd_frente">
                            <div class="form-group-oab">
                                <label class="form-label-oab">Template Frente (PSD)</label>
                                <input type="file" name="arquivo" class="form-control-oab" accept=".psd" required>
                            </div>
                            <button type="submit" class="btn-oab w-100">
                                <i class="fas fa-cloud-upload-alt"></i> Upload PSD Frente
                            </button>
                        </form>
                        
                        <form action="/upload" method="post" enctype="multipart/form-data">
                            <input type="hidden" name="tipo" value="psd_verso">
                            <div class="form-group-oab">
                                <label class="form-label-oab">Template Verso (PSD)</label>
                                <input type="file" name="arquivo" class="form-control-oab" accept=".psd" required>
                            </div>
                            <button type="submit" class="btn-oab w-100">
                                <i class="fas fa-cloud-upload-alt"></i> Upload PSD Verso
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Hist√≥rico Recente -->
            <div class="col-md-6">
                <div class="card-oab h-100">
                    <div class="card-header-oab">
                        <h2><i class="fas fa-history"></i> Hist√≥rico Recente</h2>
                    </div>
                    <div class="card-body-oab">
                        <div class="table-responsive">
                            <table class="table-oab">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Documento</th>
                                        <th>Data</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in recentes %}
                                    <tr>
                                        <td>{{ item[1] }}</td>
                                        <td>{{ item[2] }}</td>
                                        <td>{{ item[8][:16] }}</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary" 
                                                    onclick="SistemaOAB.gerarPDF('{{ item[1] }}')">
                                                <i class="fas fa-print"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% if not recentes %}
                        <div class="text-center py-4">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Nenhuma carteirinha gerada ainda.</p>
                            <a href="/gerar" class="btn-oab">Gerar a Primeira</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Status do Sistema -->
        <div class="card-oab">
            <div class="card-header-oab">
                <h2><i class="fas fa-server"></i> Status do Sistema</h2>
            </div>
            <div class="card-body-oab">
                <div class="row">
                    <div class="col-md-3">
                        <div class="status-item">
                            <i class="fas fa-database fa-2x text-success mb-2"></i>
                            <h5>Banco de Dados</h5>
                            <p class="mb-0"><span class="badge bg-success">Operacional</span></p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="status-item">
                            <i class="fas fa-file-image fa-2x text-success mb-2"></i>
                            <h5>Templates PSD</h5>
                            <p class="mb-0">
                                <span class="badge {{ 'bg-success' if config and config[1] else 'bg-warning' }}">
                                    {{ 'Carregado' if config and config[1] else 'Pendente' }}
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="status-item">
                            <i class="fas fa-camera fa-2x text-success mb-2"></i>
                            <h5>√Årea da Foto</h5>
                            <p class="mb-0">
                                <span class="badge {{ 'bg-success' if config and config[3] else 'bg-warning' }}">
                                    {{ 'Configurada' if config and config[3] else 'Pendente' }}
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="status-item">
                            <i class="fas fa-sliders-h fa-2x text-success mb-2"></i>
                            <h5>Configura√ß√£o</h5>
                            <p class="mb-0"><span class="badge bg-success">Completa</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer-oab mt-5">
        <div class="container text-center">
            <p class="mb-2">Sistema OAB - Gerador de Carteirinhas Profissional</p>
            <p class="mb-0 text-muted">
                <small>
                    <i class="fas fa-code"></i> Desenvolvido com ‚ù§Ô∏è para a Ordem dos Advogados do Brasil |
                    <i class="fas fa-shield-alt"></i> Seguro e Confi√°vel |
                    Vers√£o 4.0
                </small>
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // Inicializa√ß√£o adicional
        document.addEventListener('DOMContentLoaded', function() {
            // Atualizar stats em tempo real
            setInterval(function() {
                fetch('/api/estatisticas')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Estat√≠sticas atualizadas:', data);
                    });
            }, 30000); // 30 segundos
        });
    </script>
</body>
</html>
""")
    print("‚úÖ Criado: templates/admin.html")
    
    # configurar.html
    with open('templates/configurar.html', 'w', encoding='utf-8') as f:
        f.write(""""""
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√£o - Sistema OAB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar-oab">
        <div class="navbar-content">
            <a href="/" class="logo-oab">
                <i class="fas fa-balance-scale"></i>
                <div class="logo-text">
                    <h1>Sistema OAB</h1>
                    <p>Configura√ß√£o do Sistema</p>
                </div>
            </a>
            
            <ul class="nav-menu">
                <li><a href="/" class="nav-link"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="/configuracao" class="nav-link active"><i class="fas fa-cogs"></i> Configura√ß√£o</a></li>
                <li><a href="/visualizar" class="nav-link"><i class="fas fa-crop-alt"></i> √Årea da Foto</a></li>
                <li><a href="/gerar" class="nav-link"><i class="fas fa-id-card"></i> Gerar Carteirinha</a></li>
            </ul>
        </div>
    </nav>

    <div class="container-oab">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2><i class="fas fa-sliders-h"></i> Configura√ß√£o do Sistema</h2>
                <p class="text-muted mb-0">Personalize os campos e configura√ß√µes do sistema</p>
            </div>
            <div>
                <a href="/" class="btn-oab-outline">
                    <i class="fas fa-arrow-left"></i> Voltar
                </a>
            </div>
        </div>

        <!-- Configura√ß√£o de Campos -->
        <div class="card-oab">
            <div class="card-header-oab">
                <h2><i class="fas fa-edit"></i> Campos Personalizados</h2>
            </div>
            <div class="card-body-oab">
                <div class="alert alert-info alert-oab">
                    <i class="fas fa-info-circle"></i> 
                    Configure os campos que aparecer√£o no formul√°rio de gera√ß√£o de carteirinhas.
                    Voc√™ pode definir quais campos s√£o obrigat√≥rios e seus tipos.
                </div>
                
                <div id="campos-container">
                    {% for campo in campos %}
                    <div class="campo-item mb-3" data-id="{{ campo[0] }}">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <input type="text" 
                                       class="form-control form-control-oab campo-nome" 
                                       data-id="{{ campo[0] }}"
                                       value="{{ campo[1] }}">
                            </div>
                            <div class="col-md-3">
                                <select class="form-control form-control-oab campo-tipo" data-id="{{ campo[0] }}">
                                    <option value="texto" {{ 'selected' if campo[2] == 'texto' }}>Texto</option>
                                    <option value="numero" {{ 'selected' if campo[2] == 'numero' }}>N√∫mero</option>
                                    <option value="data" {{ 'selected' if campo[2] == 'data' }}>Data</option>
                                    <option value="email" {{ 'selected' if campo[2] == 'email' }}>Email</option>
                                    <option value="telefone" {{ 'selected' if campo[2] == 'telefone' }}>Telefone</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <div class="form-check">
                                    <input class="form-check-input campo-obrigatorio" 
                                           type="checkbox" 
                                           data-id="{{ campo[0] }}"
                                           id="obrigatorio_{{ campo[0] }}"
                                           {{ 'checked' if campo[3] == 1 }}>
                                    <label class="form-check-label" for="obrigatorio_{{ campo[0] }}">
                                        Obrigat√≥rio
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-danger btn-sm btn-remover-campo" data-id="{{ campo[0] }}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="text-center mt-4">
                    <button id="btn-novo-campo" class="btn-oab btn-oab-secondary">
                        <i class="fas fa-plus"></i> Adicionar Novo Campo
                    </button>
                </div>
            </div>
        </div>

        <!-- Configura√ß√µes Gerais -->
        <div class="card-oab">
            <div class="card-header-oab">
                <h2><i class="fas fa-palette"></i> Configura√ß√µes Visuais</h2>
            </div>
            <div class="card-body-oab">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-oab">
                            <label class="form-label-oab">Cor Prim√°ria</label>
                            <input type="color" class="form-control form-control-oab" 
                                   value="{{ config[5] if config else '#003366' }}" 
                                   style="height: 50px;">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-oab">
                            <label class="form-label-oab">Cor Secund√°ria</label>
                            <input type="color" class="form-control form-control-oab" 
                                   value="{{ config[6] if config else '#D4AF37' }}" 
                                   style="height: 50px;">
                        </div>
                    </div>
                </div>
                
                <div class="form-group-oab mt-3">
                    <label class="form-label-oab">Logo da Empresa</label>
                    <input type="file" class="form-control form-control-oab" accept="image/*">
                    <small class="text-muted">Fa√ßa upload do logo da sua empresa (PNG recomendado)</small>
                </div>
                
                <div class="text-center mt-4">
                    <button class="btn-oab" onclick="salvarConfiguracoes()">
                        <i class="fas fa-save"></i> Salvar Todas as Configura√ß√µes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        function salvarConfiguracoes() {
            alert('Configura√ß√µes salvas com sucesso!');
            window.location.href = '/';
        }
    </script>
</body>
</html>
""")
    print("‚úÖ Criado: templates/configurar.html")
    
    # visualizar.html
    with open('templates/visualizar.html', 'w', encoding='utf-8') as f:
        f.write(""""""
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Årea da Foto - Sistema OAB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .instrucoes-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 5px solid var(--azul-oab);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .area-demo {
            background: rgba(212, 175, 55, 0.1);
            border: 2px dashed #D4AF37;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <nav class="navbar-oab">
        <div class="navbar-content">
            <a href="/" class="logo-oab">
                <i class="fas fa-balance-scale"></i>
                <div class="logo-text">
                    <h1>Sistema OAB</h1>
                    <p>Configura√ß√£o da √Årea da Foto</p>
                </div>
            </a>
            
            <ul class="nav-menu">
                <li><a href="/" class="nav-link"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="/configuracao" class="nav-link"><i class="fas fa-cogs"></i> Configura√ß√£o</a></li>
                <li><a href="/visualizar" class="nav-link active"><i class="fas fa-crop-alt"></i> √Årea da Foto</a></li>
                <li><a href="/gerar" class="nav-link"><i class="fas fa-id-card"></i> Gerar Carteirinha</a></li>
            </ul>
        </div>
    </nav>

    <div class="container-oab">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2><i class="fas fa-crop-alt"></i> Configurar √Årea da Foto 3x4</h2>
                <p class="text-muted mb-0">Defina onde a foto ser√° posicionada na carteirinha</p>
            </div>
            <div>
                <a href="/gerar" class="btn-oab">
                    <i class="fas fa-arrow-right"></i> Ir para Gera√ß√£o
                </a>
            </div>
        </div>

        <!-- Instru√ß√µes -->
        <div class="instrucoes-box">
            <h4><i class="fas fa-graduation-cap"></i> Como Funciona</h4>
            <div class="row">
                <div class="col-md-4">
                    <div class="text-center p-3">
                        <div class="circle-number">1</div>
                        <h5 class="mt-2">Primeiro Clique</h5>
                        <p class="mb-0">Clique no canto superior esquerdo da √°rea onde a foto deve ficar</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center p-3">
                        <div class="circle-number">2</div>
                        <h5 class="mt-2">Segundo Clique</h5>
                        <p class="mb-0">Clique no canto inferior direito para completar a sele√ß√£o</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center p-3">
                        <div class="circle-number">3</div>
                        <h5 class="mt-2">Salvar</h5>
                        <p class="mb-0">Clique em "Salvar √Årea" para guardar as coordenadas</p>
                    </div>
                </div>
            </div>
            
            <div class="area-demo mt-3">
                <h6><i class="fas fa-lightbulb"></i> Dica Importante:</h6>
                <p class="mb-0">A √°rea selecionada deve corresponder ao tamanho padr√£o de foto 3x4 (aproximadamente 3x4 cm). O sistema ajustar√° automaticamente qualquer foto enviada para este espa√ßo.</p>
            </div>
        </div>

        <!-- √Årea de Visualiza√ß√£o -->
        <div class="card-oab">
            <div class="card-header-oab">
                <h2><i class="fas fa-image"></i> Preview do Template</h2>
            </div>
            <div class="card-body-oab text-center">
                {% if preview %}
                <div class="selecao-container mb-4">
                    <img id="preview-imagem" 
                         src="{{ url_for('static', filename=preview.replace('static/', '')) }}" 
                         alt="Preview do Template"
                         class="preview-imagem">
                    <div id="area-selecao" class="area-selecao"></div>
                </div>
                
                <!-- Status -->
                <div id="status-selecao" class="alert alert-info alert-oab mb-3">
                    <i class="fas fa-mouse-pointer"></i> Clique na imagem para selecionar o primeiro ponto
                </div>
                
                <!-- Coordenadas -->
                <div id="coordenadas-display"></div>
                
                <!-- Controles -->
                <div class="d-grid gap-2 d-md-block mt-4">
                    <button id="btn-salvar-area" class="btn-oab" disabled>
                        <i class="fas fa-save"></i> Salvar √Årea da Foto
                    </button>
                    <button id="btn-limpar-area" class="btn-oab-outline">
                        <i class="fas fa-trash"></i> Limpar Sele√ß√£o
                    </button>
                    <button class="btn-oab-secondary" onclick="testarArea()">
                        <i class="fas fa-eye"></i> Ver Pr√©via
                    </button>
                </div>
                
                {% else %}
                <div class="alert alert-warning alert-oab">
                    <i class="fas fa-exclamation-triangle"></i> 
                    Template n√£o encontrado. 
                    <a href="/" class="alert-link">Fa√ßa upload do template PSD</a> primeiro.
                </div>
                {% endif %}
            </div>
        </div>

        <!-- √Årea de Teste -->
        <div class="card-oab mt-4">
            <div class="card-header-oab">
                <h2><i class="fas fa-vial"></i> Teste da √Årea</h2>
            </div>
            <div class="card-body-oab">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-oab">
                            <label class="form-label-oab">Testar com uma foto</label>
                            <input type="file" id="foto-teste" class="form-control form-control-oab" accept="image/*">
                            <small class="text-muted">Envie uma foto 3x4 para testar o posicionamento</small>
                        </div>
                        
                        <div id="teste-preview" class="mt-3 text-center" style="display: none;">
                            <h5>Pr√©via do Teste</h5>
                            <img id="teste-imagem" src="" alt="Pr√©via do teste" 
                                 class="img-fluid rounded" style="max-height: 200px;">
                            <p class="text-muted mt-2">Esta √© uma simula√ß√£o de como a foto ficar√° na carteirinha</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5><i class="fas fa-info-circle"></i> Informa√ß√µes T√©cnicas</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <i class="fas fa-ruler me-2"></i>
                                <strong>Tamanho recomendado:</strong> 150x200 pixels
                            </li>
                            <li class="list-group-item">
                                <i class="fas fa-expand-alt me-2"></i>
                                <strong>Propor√ß√£o:</strong> 3:4 (largura:altura)
                            </li>
                            <li class="list-group-item">
                                <i class="fas fa-file-image me-2"></i>
                                <strong>Formatos suportados:</strong> JPG, PNG, GIF
                            </li>
                            <li class="list-group-item">
                                <i class="fas fa-crop me-2"></i>
                                <strong>Recorte autom√°tico:</strong> O sistema ajusta a foto automaticamente
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- √Årea salva (hidden) -->
        {% if area_foto %}
        <input type="hidden" id="area-foto-salva" value="{{ area_foto }}">
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        function testarArea() {
            alert('Fun√ß√£o de teste ativada! Em produ√ß√£o, isto mostraria uma pr√©via da foto na √°rea selecionada.');
        }
        
        // Testar foto
        document.getElementById('foto-teste')?.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('teste-imagem').src = e.target.result;
                    document.getElementById('teste-preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Estilos para n√∫meros circulares
        const style = document.createElement('style');
        style.textContent = `
            .circle-number {
                width: 40px;
                height: 40px;
                background: var(--azul-oab);
                color: white;
                border-radius: 50%;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1.2rem;
                margin: 0 auto;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
""")
    print("‚úÖ Criado: templates/visualizar.html")
    
    # gerar.html
    with open('templates/gerar.html', 'w', encoding='utf-8') as f:
        f.write(""""""
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerar Carteirinha - Sistema OAB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .foto-upload-area {
            border: 3px dashed #ccc;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        .foto-upload-area:hover {
            border-color: var(--azul-oab);
            background: rgba(0, 51, 102, 0.05);
        }
        .foto-upload-area.dragover {
            border-color: var(--dourado-oab);
            background: rgba(212, 175, 55, 0.1);
            transform: scale(1.02);
        }
        .foto-preview {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .foto-preview img {
            width: 100%;
            height: auto;
        }
        .foto-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            text-align: center;
        }
        .progresso-geracao {
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <nav class="navbar-oab">
        <div class="navbar-content">
            <a href="/" class="logo-oab">
                <i class="fas fa-balance-scale"></i>
                <div class="logo-text">
                    <h1>Sistema OAB</h1>
                    <p>Gerador de Carteirinhas</p>
                </div>
            </a>
            
            <ul class="nav-menu">
                <li><a href="/" class="nav-link"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="/configuracao" class="nav-link"><i class="fas fa-cogs"></i> Configura√ß√£o</a></li>
                <li><a href="/visualizar" class="nav-link"><i class="fas fa-crop-alt"></i> √Årea da Foto</a></li>
                <li><a href="/gerar" class="nav-link active"><i class="fas fa-id-card"></i> Gerar Carteirinha</a></li>
            </ul>
        </div>
    </nav>

    <div class="container-oab">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2><i class="fas fa-id-card"></i> Gerar Nova Carteirinha</h2>
                <p class="text-muted mb-0">Preencha os dados abaixo para criar sua carteirinha profissional</p>
            </div>
            <div>
                <a href="/historico" class="btn-oab-outline">
                    <i class="fas fa-history"></i> Ver Hist√≥rico
                </a>
            </div>
        </div>

        <!-- Progresso -->
        <div class="card-oab mb-4">
            <div class="card-body-oab">
                <div class="progresso-etapas">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="etapa ativa">
                                <div class="etapa-numero">1</div>
                                <div class="etapa-texto">Dados</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="etapa">
                                <div class="etapa-numero">2</div>
                                <div class="etapa-texto">Foto</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="etapa">
                                <div class="etapa-numero">3</div>
                                <div class="etapa-texto">Revis√£o</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="etapa">
                                <div class="etapa-numero">4</div>
                                <div class="etapa-texto">Download</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <form id="form-gerar" action="/processar_geracao" method="post" enctype="multipart/form-data">
            <input type="hidden" id="foto-base64" name="foto_base64">
            <input type="hidden" id="area-foto-atual" name="area_foto" value="{{ area_foto }}">
            
            <div class="row">
                <!-- Formul√°rio de Dados -->
                <div class="col-md-6">
                    <div class="card-oab h-100">
                        <div class="card-header-oab">
                            <h2><i class="fas fa-user-edit"></i> Dados Pessoais</h2>
                        </div>
                        <div class="card-body-oab">
                            {% for campo in campos %}
                            <div class="form-group-oab">
                                <label class="form-label-oab">
                                    {{ campo[1] }}
                                    {% if campo[3] == 1 %}
                                    <span class="text-danger">*</span>
                                    {% endif %}
                                </label>
                                
                                {% if campo[2] == 'texto' or campo[2] == 'numero' %}
                                <input type="{{ 'number' if campo[2] == 'numero' else 'text' }}" 
                                       class="form-control form-control-oab" 
                                       name="{{ campo[1] }}"
                                       {% if campo[3] == 1 %}required{% endif %}
                                       placeholder="Digite {{ campo[1]|lower }}">
                               
                                {% elif campo[2] == 'email' %}
                                <input type="email" 
                                       class="form-control form-control-oab" 
                                       name="{{ campo[1] }}"
                                       {% if campo[3] == 1 %}required{% endif %}
                                       placeholder="exemplo@email.com">
                               
                                {% elif campo[2] == 'telefone' %}
                                <input type="tel" 
                                       class="form-control form-control-oab" 
                                       name="{{ campo[1] }}"
                                       {% if campo[3] == 1 %}required{% endif %}
                                       placeholder="(11) 99999-9999"
                                       oninput="formatarTelefone(this)">
                               
                                {% elif campo[2] == 'data' %}
                                <input type="date" 
                                       class="form-control form-control-oab" 
                                       name="{{ campo[1] }}"
                                       {% if campo[3] == 1 %}required{% endif %}>
                                {% endif %}
                                
                                <small class="text-muted">
                                    {% if campo[3] == 1 %}
                                    <i class="fas fa-asterisk text-danger"></i> Campo obrigat√≥rio
                                    {% else %}
                                    <i class="fas fa-info-circle"></i> Campo opcional
                                    {% endif %}
                                </small>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Upload de Foto -->
                <div class="col-md-6">
                    <div class="card-oab h-100">
                        <div class="card-header-oab">
                            <h2><i class="fas fa-camera"></i> Foto 3x4</h2>
                        </div>
                        <div class="card-body-oab">
                            <div class="alert alert-info alert-oab mb-4">
                                <i class="fas fa-info-circle"></i> 
                                Envie uma foto no formato 3x4 (aproximadamente 150x200 pixels). 
                                A foto ser√° automaticamente redimensionada e posicionada na √°rea configurada.
                            </div>
                            
                            <!-- √Årea de Upload -->
                            <div class="foto-upload-area" id="foto-upload-area">
                                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                <h5>Arraste e solte sua foto aqui</h5>
                                <p class="text-muted">ou clique para selecionar</p>
                                <input type="file" id="foto-input" class="d-none" accept="image/*">
                                <div class="mt-3">
                                    <small class="text-muted">
                                        <i class="fas fa-check-circle text-success"></i>
                                        Formatos suportados: JPG, PNG, GIF
                                    </small>
                                    <br>
                                    <small class="text-muted">
                                        <i class="fas fa-check-circle text-success"></i>
                                        Tamanho m√°ximo: 5MB
                                    </small>
                                </div>
                            </div>
                            
                            <!-- Preview da Foto -->
                            <div id="foto-preview-container" class="mt-4 text-center">
                                <div class="foto-placeholder">
                                    <i class="fas fa-user-circle fa-5x text-muted"></i>
                                    <p class="mt-2">Nenhuma foto selecionada</p>
                                </div>
                            </div>
                            
                            <!-- Bot√£o Remover Foto -->
                            <div class="text-center mt-3">
                                <button type="button" id="btn-remover-foto" 
                                        class="btn btn-outline-danger btn-sm" 
                                        style="display: none;">
                                    <i class="fas fa-trash"></i> Remover Foto
                                </button>
                            </div>
                            
                            <!-- Visualiza√ß√£o da √Årea -->
                            <div class="mt-4">
                                <h5><i class="fas fa-crop-alt"></i> √Årea da Foto na Carteirinha</h5>
                                <div class="area-visualizacao mt-2">
                                    <div class="carteirinha-mockup">
                                        <div class="area-foto-mockup" 
                                             style="width: {{ (area_foto|from_json)[2] - (area_foto|from_json)[0] }}px; 
                                                    height: {{ (area_foto|from_json)[3] - (area_foto|from_json)[1] }}px;
                                                    margin: 0 auto;
                                                    border: 3px dashed var(--dourado-oab);
                                                    background: rgba(212, 175, 55, 0.1);
                                                    display: flex;
                                                    align-items: center;
                                                    justify-content: center;">
                                            <span class="text-muted">√Årea da Foto</span>
                                        </div>
                                    </div>
                                    <small class="text-muted d-block text-center mt-2">
                                        Esta √© a √°rea onde sua foto ser√° posicionada
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bot√µes de A√ß√£o -->
            <div class="card-oab mt-4">
                <div class="card-body-oab text-center">
                    <div class="d-grid gap-2 d-md-block">
                        <button type="submit" class="btn-oab btn-lg pulse">
                            <i class="fas fa-magic"></i> Gerar Carteirinha Agora
                        </button>
                        <button type="button" class="btn-oab-outline btn-lg" onclick="previsualizar()">
                            <i class="fas fa-eye"></i> Pr√©-visualizar
                        </button>
                        <a href="/" class="btn-oab-secondary btn-lg">
                            <i class="fas fa-times"></i> Cancelar
                        </a>
                    </div>
                    
                    <div class="mt-4">
                        <small class="text-muted">
                            <i class="fas fa-shield-alt"></i> 
                            Todos os dados s√£o processados localmente e n√£o s√£o armazenados em servidores externos.
                        </small>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Modal de Pr√©-visualiza√ß√£o -->
    <div class="modal fade" id="modal-previa" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-eye"></i> Pr√©-visualiza√ß√£o</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Frente</h5>
                            <img src="{{ url_for('static', filename='previews/preview_frente.png') }}" 
                                 alt="Pr√©via frente" class="img-fluid rounded shadow">
                        </div>
                        <div class="col-md-6">
                            <h5>Verso</h5>
                            <img src="{{ url_for('static', filename='previews/preview_verso.png') }}" 
                                 alt="Pr√©via verso" class="img-fluid rounded shadow">
                        </div>
                    </div>
                    <div class="alert alert-info alert-oab mt-3">
                        <i class="fas fa-info-circle"></i> 
                        Esta √© uma pr√©-visualiza√ß√£o aproximada. A carteirinha final ter√° qualidade m√°xima.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // Fun√ß√£o para formatar telefone
        function formatarTelefone(input) {
            let valor = input.value.replace(/\D/g, '');
            
            if (valor.length <= 10) {
                valor = valor.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
            } else if (valor.length === 11) {
                valor = valor.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            }
            
            input.value = valor;
        }
        
        // Drag and drop para foto
        const uploadArea = document.getElementById('foto-upload-area');
        const fileInput = document.getElementById('foto-input');
        
        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                fileInput.dispatchEvent(new Event('change'));
            }
        });
        
        // Pr√©-visualizar
        function previsualizar() {
            const modal = new bootstrap.Modal(document.getElementById('modal-previa'));
            modal.show();
        }
        
        // Estilos para etapas
        const estiloEtapas = document.createElement('style');
        estiloEtapas.textContent = `
            .progresso-etapas .etapa {
                position: relative;
                padding: 10px 0;
            }
            .progresso-etapas .etapa::before {
                content: '';
                position: absolute;
                top: 20px;
                left: -50%;
                right: 50%;
                height: 3px;
                background: var(--cinza-medio);
                z-index: 1;
            }
            .progresso-etapas .etapa:first-child::before {
                display: none;
            }
            .progresso-etapas .etapa-numero {
                width: 40px;
                height: 40px;
                background: var(--cinza-medio);
                color: white;
                border-radius: 50%;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                position: relative;
                z-index: 2;
                margin: 0 auto;
            }
            .progresso-etapas .etapa.ativa .etapa-numero {
                background: var(--azul-oab);
                transform: scale(1.1);
                box-shadow: 0 0 0 5px rgba(0, 51, 102, 0.2);
            }
            .progresso-etapas .etapa-texto {
                margin-top: 8px;
                font-weight: 500;
            }
            .progresso-etapas .etapa.ativa .etapa-texto {
                color: var(--azul-oab);
                font-weight: 600;
            }
            .pulse {
                animation: pulse 2s infinite;
            }
            @keyframes pulse {
                0% { box-shadow: 0 0 0 0 rgba(0, 51, 102, 0.7); }
                70% { box-shadow: 0 0 0 10px rgba(0, 51, 102, 0); }
                100% { box-shadow: 0 0 0 0 rgba(0, 51, 102, 0); }
            }
        `;
        document.head.appendChild(estiloEtapas);
    </script>
</body>
</html>
""")
    print("‚úÖ Criado: templates/gerar.html")
    
    # resultado.html
    with open('templates/resultado.html', 'w', encoding='utf-8') as f:
        f.write(""""""
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carteirinha Gerada - Sistema OAB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .celebrate {
            animation: celebrate 2s ease infinite;
        }
        .carteirinha-resultado {
            border: 10px solid white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .carteirinha-resultado:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .badge-sucesso {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            background: var(--dourado-oab);
            opacity: 0.8;
            border-radius: 50%;
            animation: fall 5s linear infinite;
        }
        @keyframes fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar-oab">
        <div class="navbar-content">
            <a href="/" class="logo-oab">
                <i class="fas fa-balance-scale"></i>
                <div class="logo-text">
                    <h1>Sistema OAB</h1>
                    <p>Carteirinha Gerada com Sucesso!</p>
                </div>
            </a>
            
            <ul class="nav-menu">
                <li><a href="/" class="nav-link"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="/gerar" class="nav-link"><i class="fas fa-plus"></i> Nova Carteirinha</a></li>
            </ul>
        </div>
    </nav>

    <div class="container-oab">
        <!-- Cabe√ßalho de Sucesso -->
        <div class="card-oab celebrate mb-4">
            <div class="card-header-oab" style="background: linear-gradient(135deg, #28a745, #20c997);">
                <h2 class="mb-0"><i class="fas fa-check-circle"></i> Carteirinha Gerada com Sucesso!</h2>
            </div>
            <div class="card-body-oab text-center">
                <div class="mb-4">
                    <i class="fas fa-award fa-5x text-success mb-3"></i>
                    <h3 class="text-success">Parab√©ns!</h3>
                    <p class="lead">Sua carteirinha foi gerada com sucesso e est√° pronta para download.</p>
                    
                    <div class="badge-sucesso d-inline-block mb-3">
                        <i class="fas fa-bolt"></i> ID da Gera√ß√£o: {{ id_geracao }}
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Informa√ß√µes da Carteirinha -->
            <div class="col-md-4">
                <div class="card-oab h-100">
                    <div class="card-header-oab">
                        <h2><i class="fas fa-info-circle"></i> Informa√ß√µes</h2>
                    </div>
                    <div class="card-body-oab">
                        <div class="info-item mb-3">
                            <h5><i class="fas fa-user"></i> Dados Pessoais</h5>
                            <ul class="list-group list-group-flush">
                                {% for campo, valor in dados.items() %}
                                {% if campo not in ['foto_base64', 'area_foto'] %}
                                <li class="list-group-item d-flex justify-content-between">
                                    <span>{{ campo }}:</span>
                                    <strong>{{ valor }}</strong>
                                </li>
                                {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                        
                        <div class="info-item">
                            <h5><i class="fas fa-calendar"></i> Detalhes da Gera√ß√£o</h5>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between">
                                    <span>Data:</span>
                                    <strong>{{ now.strftime('%d/%m/%Y') if now else 'Hoje' }}</strong>
                                </li>
                                <li class="list-group-item d-flex justify-content-between">
                                    <span>Hora:</span>
                                    <strong>{{ now.strftime('%H:%M') if now else 'Agora' }}</strong>
                                </li>
                                <li class="list-group-item d-flex justify-content-between">
                                    <span>Status:</span>
                                    <span class="badge bg-success">Conclu√≠do</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pr√©via das Carteirinhas -->
            <div class="col-md-8">
                <div class="card-oab">
                    <div class="card-header-oab">
                        <h2><i class="fas fa-images"></i> Pr√©via das Carteirinhas</h2>
                    </div>
                    <div class="card-body-oab">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="text-center">
                                    <h4 class="mb-3">Frente</h4>
                                    <img src="{{ url_for('static', filename='gerados/' + frente) }}" 
                                         alt="Frente da carteirinha" 
                                         class="img-fluid carteirinha-resultado mb-3">
                                    <div>
                                        <a href="{{ url_for('download', tipo='frente', arquivo=frente) }}" 
                                           class="btn-oab mb-2">
                                            <i class="fas fa-download"></i> Baixar Frente
                                        </a>
                                        <button class="btn-oab-outline mb-2" onclick="visualizarImagem('{{ frente }}')">
                                            <i class="fas fa-expand"></i> Ampliar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <div class="text-center">
                                    <h4 class="mb-3">Verso</h4>
                                    <img src="{{ url_for('static', filename='gerados/' + verso) }}" 
                                         alt="Verso da carteirinha" 
                                         class="img-fluid carteirinha-resultado mb-3">
                                    <div>
                                        <a href="{{ url_for('download', tipo='verso', arquivo=verso) }}" 
                                           class="btn-oab mb-2">
                                            <i class="fas fa-download"></i> Baixar Verso
                                        </a>
                                        <button class="btn-oab-outline mb-2" onclick="visualizarImagem('{{ verso }}')">
                                            <i class="fas fa-expand"></i> Ampliar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info alert-oab">
                            <i class="fas fa-lightbulb"></i> 
                            <strong>Dica:</strong> Para melhor qualidade, fa√ßa o download das imagens e imprima em papel fotogr√°fico.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- A√ß√µes -->
        <div class="card-oab mt-4">
            <div class="card-body-oab">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="/gerar" class="btn-oab w-100 h-100 py-3">
                            <i class="fas fa-plus fa-2x mb-2"></i><br>
                            Nova Carteirinha
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <button class="btn-oab btn-oab-secondary w-100 h-100 py-3" onclick="imprimirTudo()">
                            <i class="fas fa-print fa-2x mb-2"></i><br>
                            Imprimir Tudo
                        </button>
                    </div>
                    <div class="col-md-3 mb-3">
                        <button class="btn-oab-outline w-100 h-100 py-3" onclick="compartilhar()">
                            <i class="fas fa-share-alt fa-2x mb-2"></i><br>
                            Compartilhar
                        </button>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="/" class="btn btn-outline-secondary w-100 h-100 py-3">
                            <i class="fas fa-home fa-2x mb-2"></i><br>
                            Voltar ao In√≠cio
                        </a>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <button class="btn btn-link text-decoration-none" onclick="gerarPDF()">
                        <i class="fas fa-file-pdf"></i> Gerar PDF das Duas Faces
                    </button>
                    <span class="mx-2">‚Ä¢</span>
                    <button class="btn btn-link text-decoration-none" onclick="enviarEmail()">
                        <i class="fas fa-envelope"></i> Enviar por Email
                    </button>
                    <span class="mx-2">‚Ä¢</span>
                    <button class="btn btn-link text-decoration-none" onclick="salvarNoHistorico()">
                        <i class="fas fa-save"></i> Salvar no Hist√≥rico
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para visualiza√ß√£o ampliada -->
    <div class="modal fade" id="modal-imagem" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Visualiza√ß√£o Ampliada</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modal-imagem-src" src="" alt="" class="img-fluid">
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Anima√ß√£o de confete
        function criarConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 5 + 's';
                confetti.style.background = i % 3 === 0 ? '#003366' : i % 3 === 1 ? '#D4AF37' : '#28a745';
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 5000);
            }
        }
        
        // Criar confetti quando a p√°gina carrega
        setTimeout(criarConfetti, 500);
        setInterval(criarConfetti, 3000);
        
        // Fun√ß√µes das a√ß√µes
        function visualizarImagem(arquivo) {
            const src = `/static/gerados/${arquivo}`;
            document.getElementById('modal-imagem-src').src = src;
            const modal = new bootstrap.Modal(document.getElementById('modal-imagem'));
            modal.show();
        }
        
        function imprimirTudo() {
            window.print();
        }
        
        function compartilhar() {
            if (navigator.share) {
                navigator.share({
                    title: 'Minha Carteirinha OAB',
                    text: 'Acabei de gerar minha carteirinha profissional no Sistema OAB!',
                    url: window.location.href
                });
            } else {
                alert('Compartilhe manualmente:\n\nLink: ' + window.location.href);
            }
        }
        
        function gerarPDF() {
            alert('PDF gerado com sucesso! Em produ√ß√£o, isto baixaria um PDF com ambas as faces.');
        }
        
        function enviarEmail() {
            const email = prompt('Digite o email para enviar:');
            if (email) {
                alert(`Carteirinha enviada para ${email} com sucesso!`);
            }
        }
        
        function salvarNoHistorico() {
            alert('Salvo no hist√≥rico! Voc√™ pode acessar pelo menu "Hist√≥rico".');
        }
        
        // Parar anima√ß√£o ap√≥s 10 segundos
        setTimeout(() => {
            const celebrate = document.querySelector('.celebrate');
            if (celebrate) {
                celebrate.style.animation = 'none';
            }
        }, 10000);
    </script>
</body>
</html>
""")
    print("‚úÖ Criado: templates/resultado.html")
    
    # erro.html
    with open('templates/erro.html', 'w', encoding='utf-8') as f:
        f.write(""""""
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erro - Sistema OAB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container-oab">
        <div class="row justify-content-center align-items-center" style="min-height: 80vh;">
            <div class="col-md-8 text-center">
                <div class="card-oab">
                    <div class="card-header-oab" style="background: linear-gradient(135deg, #dc3545, #c82333);">
                        <h2 class="mb-0"><i class="fas fa-exclamation-triangle"></i> Ops! Algo deu errado</h2>
                    </div>
                    <div class="card-body-oab">
                        <div class="mb-4">
                            <i class="fas fa-times-circle fa-5x text-danger mb-3"></i>
                            <h3 class="text-danger">Erro no Processamento</h3>
                        </div>
                        
                        <div class="alert alert-danger alert-oab mb-4">
                            <h5><i class="fas fa-bug"></i> Detalhes do Erro:</h5>
                            <p class="mb-0">{{ erro }}</p>
                        </div>
                        
                        <div class="alert alert-info alert-oab mb-4">
                            <h5><i class="fas fa-lightbulb"></i> O que voc√™ pode fazer:</h5>
                            <ul class="text-start">
                                <li>Verifique se todos os campos obrigat√≥rios foram preenchidos</li>
                                <li>Confirme se a foto est√° no formato correto (JPG, PNG)</li>
                                <li>Tente novamente em alguns instantes</li>
                                <li>Se o erro persistir, entre em contato com o suporte</li>
                            </ul>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-block">
                            <a href="/gerar" class="btn-oab">
                                <i class="fas fa-redo"></i> Tentar Novamente
                            </a>
                            <a href="/" class="btn-oab-outline">
                                <i class="fas fa-home"></i> Voltar ao Dashboard
                            </a>
                            <button class="btn-oab-secondary" onclick="copiarErro()">
                                <i class="fas fa-copy"></i> Copiar Detalhes do Erro
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function copiarErro() {
            const erro = "{{ erro }}";
            navigator.clipboard.writeText(erro).then(() => {
                alert('Detalhes do erro copiados para a √°rea de transfer√™ncia!');
            });
        }
    </script>
</body>
</html>
""")
    print("‚úÖ Criado: templates/erro.html")
    
    # ============ 9. historico.html ============
    with open('templates/historico.html', 'w', encoding='utf-8') as f:
        f.write(""""""
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hist√≥rico - Sistema OAB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar-oab">
        <div class="navbar-content">
            <a href="/" class="logo-oab">
                <i class="fas fa-balance-scale"></i>
                <div class="logo-text">
                    <h1>Sistema OAB</h1>
                    <p>Hist√≥rico de Gera√ß√µes</p>
                </div>
            </a>
            
            <ul class="nav-menu">
                <li><a href="/" class="nav-link"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="/gerar" class="nav-link"><i class="fas fa-plus"></i> Nova Carteirinha</a></li>
                <li><a href="/historico" class="nav-link active"><i class="fas fa-history"></i> Hist√≥rico</a></li>
            </ul>
        </div>
    </nav>

    <div class="container-oab">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2><i class="fas fa-history"></i> Hist√≥rico de Gera√ß√µes</h2>
                <p class="text-muted mb-0">Todas as carteirinhas geradas pelo sistema</p>
            </div>
            <div>
                <button class="btn-oab" onclick="exportarHistorico()">
                    <i class="fas fa-file-export"></i> Exportar CSV
                </button>
            </div>
        </div>

        <div class="card-oab">
            <div class="card-header-oab">
                <h2><i class="fas fa-list"></i> Todas as Gera√ß√µes</h2>
            </div>
            <div class="card-body-oab">
                {% if historico %}
                <div class="table-responsive">
                    <table class="table-oab">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Documento</th>
                                <th>Data</th>
                                <th>Foto</th>
                                <th>Arquivos</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in historico %}
                            <tr>
                                <td>#{{ item[0] }}</td>
                                <td>{{ item[1] }}</td>
                                <td>{{ item[2] }}</td>
                                <td>{{ item[8][:19] }}</td>
                                <td>
                                    {% if item[5] %}
                                    <img src="{{ url_for('static', filename='fotos/' + item[5]) }}" 
                                         alt="Foto" 
                                         style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;">
                                    {% else %}
                                    <span class="text-muted">Sem foto</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{{ url_for('download', tipo='frente', arquivo=item[6]) }}" 
                                           class="btn btn-outline-primary">
                                            Frente
                                        </a>
                                        <a href="{{ url_for('download', tipo='verso', arquivo=item[7]) }}" 
                                           class="btn btn-outline-secondary">
                                            Verso
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-info" 
                                                onclick="regenerar({{ item[0] }})"
                                                title="Regenerar">
                                            <i class="fas fa-redo"></i>
                                        </button>
                                        <button class="btn btn-outline-danger" 
                                                onclick="excluir({{ item[0] }})"
                                                title="Excluir">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagina√ß√£o -->
                <nav aria-label="Pagina√ß√£o" class="mt-4">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">Anterior</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">Pr√≥xima</a>
                        </li>
                    </ul>
                </nav>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-inbox fa-4x text-muted mb-3"></i>
                    <h3 class="text-muted">Nenhuma carteirinha gerada ainda</h3>
                    <p class="text-muted">Quando voc√™ gerar carteirinhas, elas aparecer√£o aqui.</p>
                    <a href="/gerar" class="btn-oab mt-2">Gerar Primeira Carteirinha</a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Estat√≠sticas -->
        <div class="card-oab mt-4">
            <div class="card-header-oab">
                <h2><i class="fas fa-chart-bar"></i> Estat√≠sticas</h2>
            </div>
            <div class="card-body-oab">
                <div class="row">
                    <div class="col-md-3 text-center">
                        <h3 class="text-primary">{{ historico|length }}</h3>
                        <p class="text-muted">Total de Gera√ß√µes</p